I"§<h3 id="woodpeckeræä¾›äº†macå’Œappä¹‹é—´çš„é€šä¿¡æ¸ é“å¹¶æä¾›äº†ç®€å•çš„é€šä¿¡apiå¼€å‘è€…å¯ä»¥è½»æ¾å®šåˆ¶è‡ªå·±çš„æ’ä»¶å·¥å…·">Woodpeckeræä¾›äº†Macå’ŒAppä¹‹é—´çš„é€šä¿¡æ¸ é“ï¼Œå¹¶æä¾›äº†ç®€å•çš„é€šä¿¡Apiï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾å®šåˆ¶è‡ªå·±çš„æ’ä»¶å·¥å…·ã€‚</h3>

<h2 id="åˆ›å»ºæ’ä»¶">åˆ›å»ºæ’ä»¶:</h2>

<ol>
  <li>
    <p>åˆ›å»ºserviceï¼Œå®ç°å®ƒçš„åŠ¨ä½œåˆ—è¡¨.</p>
  </li>
  <li>
    <p>æ³¨å†Œåˆ›å»ºçš„service</p>
  </li>
  <li>
    <p>åœ¨Macå®¢æˆ·ç«¯ä½¿ç”¨service</p>
  </li>
</ol>

<p>ä¸‹é¢æˆ‘ä»¬å®ç°ä¸€ä¸ªåä¸ºâ€œEchoServiceâ€çš„serviceæ¥æ¼”ç¤ºå…·ä½“æ­¥éª¤ã€‚</p>

<ul>
  <li><a href="https://github.com/appwoodpecker/woodpecker-ios">Demoé¡¹ç›®</a></li>
</ul>

<h3 id="1-åˆ›å»ºservice">1. åˆ›å»ºService</h3>

<p>åœ¨Woodpeckerä¸­ADHServiceç±»ä»£è¡¨serviceå¯¹è±¡, æˆ‘ä»¬åˆ›å»ºADHServiceçš„å­ç±»EchoServiceã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@interface EchoService : ADHService

@end

</code></pre></div></div>

<p>æ¯ä¸€ä¸ªserviceæœ‰åç§°(name)å’Œå®ƒçš„åŠ¨ä½œåˆ—è¡¨(actionList)
æˆ‘ä»¬EchoServiceåç§°è®¾ä¸ºâ€œadh.EchoServiceâ€ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªåŠ¨ä½œâ€echoâ€ã€‚</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@implementation EchoService

+ (NSString *)serviceName
{
    return @"adh.EchoService";
}

+ (NSDictionary *)&lt;NSString *,NSString *&gt;actionList
{
    return @{
            	@"echo" : @selector(onRequestEcho:), 
            };
}

/*
åœ¨Appæ¥æ”¶åˆ°serviceåä¸º"adh.EchoService"ï¼ŒåŠ¨ä½œä¸ºâ€echo"çš„è¯·æ±‚æ—¶ï¼Œä¸‹é¢çš„æ–¹æ³•å°†ä¼šè¢«è°ƒç”¨
requestå‚æ•°å¯ä»¥åŒ…å«ä¸€ä¸ªNSDictionaryç±»å‹çš„bodyå’ŒNSDataç±»å‹çš„payload
å¤„ç†ç»“æŸåä½ éœ€è¦è°ƒç”¨requestçš„finishæ–¹æ³•æ¥å“åº”è¯·æ±‚
*/
- (void)onRequestEcho: (ADHRequest *)request
{
    NSDictioanry * body = request.body;
    NSData * payload = request.payload;
    /**
        your code
    */
    [request finish];
}

@end
</code></pre></div></div>

<h3 id="2-æ³¨å†Œåˆ›å»ºçš„service">2. æ³¨å†Œåˆ›å»ºçš„Service</h3>

<p>åœ¨ä½¿ç”¨EchoServiceä¹‹å‰ï¼Œä½ éœ€è¦å…ˆåœ¨Appæ³¨å†Œå®ƒ</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- (void)viewDidLoad {
    [super viewDidLoad];

    [[ADHOrganizer organizer] registerService:[EchoService service]];
}
</code></pre></div></div>

<h3 id="3-åœ¨macå®¢æˆ·ç«¯ä½¿ç”¨åˆ›å»ºçš„service">3. åœ¨Macå®¢æˆ·ç«¯ä½¿ç”¨åˆ›å»ºçš„Service</h3>

<p>æœ‰ä¸¤ç§æ–¹æ³•ä½¿ç”¨Serviceï¼š</p>

<ol>
  <li>
    <p>é€šè¿‡Macå®¢æˆ·ç«¯çš„Apiå·¥å…·æ¥è°ƒç”¨Appçš„service</p>
  </li>
  <li>
    <p>åœ¨Macç«¯åˆ›å»ºä¸€ä¸ªwebæ’ä»¶ï¼Œç„¶ååœ¨æ’ä»¶ä¸­è°ƒç”¨serviceï¼Œåˆ›å»ºçš„æ’ä»¶ä¼šåœ¨Macå®¢æˆ·ç«¯çš„å·¥å…·æ ä¸­æ˜¾ç¤º</p>
  </li>
</ol>

<p>ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸¤ç§æ–¹å¼</p>

<h4 id="31-åœ¨macå®¢æˆ·ç«¯çš„apiå·¥å…·è°ƒç”¨serviceç‚¹å‡»èœå•plugin---tool">3.1 åœ¨Macå®¢æˆ·ç«¯çš„Apiå·¥å…·è°ƒç”¨Serviceï¼Œç‚¹å‡»èœå•Plugin -&gt; Tool</h4>

<p><img src="/assets/img/io1.png" alt="io1" /></p>

<p>ä½ å¯ä»¥å¡«å†™4ä¸ªå­—æ®µï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Service: å°†è¦è°ƒç”¨çš„serviceåç§°ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©"adh.EchoService"ã€‚

Action: å°†è¦è°ƒç”¨çš„åŠ¨ä½œåç§°ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©"echo"ã€‚

Body: ä½ å¯ä»¥ç»™è¯·æ±‚æ·»åŠ ä¸€ä¸ªNSDictionaryç±»å‹çš„å‚æ•°(è¿™é‡Œéœ€è¦å¡«å†™å­—å…¸çš„jsonå­—ç¬¦ä¸²) , åœ¨æ¥æ”¶æ–¹ï¼Œä½ å¯ä»¥é€šè¿‡request.bodyæ¥è·å–è¯¥å€¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å¡«ä»»ä½•å†…å®¹ã€‚

Payload: ä½ å¯ä»¥ç»™è¯·æ±‚æ·»åŠ ä¸€ä¸ªNSDataç±»å‹çš„å‚æ•°(è¿™é‡Œè¯·é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶), åœ¨æ¥æ”¶æ–¹ï¼Œä½ å¯ä»¥é€šè¿‡request.payloadè·å–è¯¥å€¼, è¿™é‡Œæˆ‘ä»¬ä¸é€‰æ‹©æ–‡ä»¶ã€‚
</code></pre></div></div>

<h4 id="32-åˆ›å»ºmacç«¯webæ’ä»¶ä½¿ç”¨service">3.2 åˆ›å»ºMacç«¯webæ’ä»¶ä½¿ç”¨Service</h4>

<p>ä¸€ä¸ªwebæ’ä»¶å®é™…ä¸Šæ˜¯ä¸€ä¸ªåœ¨Pluginç›®å½•çš„bundleåŒ…ï¼ˆæ’ä»¶ç›®å½•å¯ä»¥åœ¨å®¢æˆ·ç«¯çš„Plugin -&gt; Homeæ‰¾åˆ°ï¼‰ã€‚
æ’ä»¶bundleè‡³å°‘åº”è¯¥åŒ…å«ä¸¤ä¸ªæ–‡ä»¶ï¼š</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>index.html ï¼ˆæ’ä»¶å…¥å£æ–‡ä»¶)
icon.png (æ’ä»¶çš„å›¾æ ‡ï¼Œå°†åœ¨å·¥å…·æ æ˜¾ç¤º)
</code></pre></div></div>

<p>åœ¨webæ’ä»¶å†…ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨â€adhCallClientApiâ€æ–¹æ³•æ¥è°ƒç”¨Appçš„serviceï¼Œï¼ˆåœ¨Plugin/adh.bundle/adh.jsä¸­å®šä¹‰ï¼‰</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- in html --&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"../adh.bundle/adhjs.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/head&gt;</span>

<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
    <span class="kd">function</span> <span class="nx">callService</span><span class="p">(){</span>
      <span class="c1">//call Echoservice</span>
      <span class="nx">adhCallClientApi</span><span class="p">(</span><span class="dl">'</span><span class="s1">adh.EchoService</span><span class="dl">'</span><span class="p">,</span><span class="dl">'</span><span class="s1">echo</span><span class="dl">'</span><span class="p">,</span><span class="dl">''</span><span class="p">,</span><span class="dl">''</span><span class="p">,</span><span class="kd">function</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="nx">payload</span><span class="p">){</span>
			
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//in adh.bundle/adh.js</span>

<span class="cm">/**
call app service` action

@p service: service name
@p action: action name
@p data: object that could be jsonfy
@p payload: binary data

on response the callback function will be called, the callback could contains a object and a payload depends on your service implentation
*/</span>

<span class="kd">function</span> <span class="nx">adhCallClientApi</span><span class="p">(</span><span class="nx">service</span><span class="p">,</span><span class="nx">action</span><span class="p">,</span><span class="nx">data</span><span class="p">,</span><span class="nx">payload</span><span class="p">,</span><span class="nx">callback</span><span class="p">)</span>
<span class="p">{</span>
	
<span class="p">}</span>

</code></pre></div></div>
<p>åœ¨webæ’ä»¶å¼€å®Œåï¼Œç‚¹å‡»èœå•æ çš„â€œPlugin -&gt; Reloadâ€æ¥åŠ è½½æ’ä»¶ï¼ŒåŠ è½½åæ’ä»¶å°†åœ¨å·¥å…·æ ä¸­æ˜¾ç¤ºã€‚ï¼ˆç¼–å†™æ—¶å¯å‚è€ƒæ’ä»¶ç›®å½•çš„Web Console.bundleï¼‰</p>

:ET